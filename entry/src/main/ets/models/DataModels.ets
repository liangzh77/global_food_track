/**
 * é£Ÿç‰©å…¨çƒå² - æ•°æ®æ¨¡å‹å®šä¹‰
 */

// æ—¶é—´è¡¨ç¤º
export interface TimePeriod {
  year?: number;
  display: string;
}

// åœ°ç†ä½ç½®ç±»å‹
export type LocationType = 'continent' | 'country' | 'region';

// åœ°ç†ä½ç½®
export interface Location {
  id: string;
  name: string;
  type: LocationType;
  parent?: string;
}

// ä½œç‰©ç±»åˆ«
export type CropCategory =
  | 'grain'      // è°·ç‰©
  | 'vegetable'  // è”¬èœ
  | 'fruit'      // æ°´æœ
  | 'legume'     // è±†ç±»
  | 'spice'      // é¦™æ–™
  | 'beverage'   // é¥®æ–™ä½œç‰©
  | 'oil'        // æ²¹æ–™ä½œç‰©
  | 'sugar'      // ç³–æ–™ä½œç‰©
  | 'nut'        // åšæœ
  | 'other';     // å…¶ä»–ä½œç‰©

// é£Ÿç‰©ç±»åˆ«
export type FoodCategory =
  | 'staple'     // ä¸»é£Ÿ
  | 'dish'       // èœè‚´
  | 'beverage'   // é¥®å“
  | 'dessert'    // ç”œç‚¹
  | 'snack'      // å°åƒ
  | 'condiment'  // è°ƒå‘³å“
  | 'preserved'; // è…Œåˆ¶é£Ÿå“

// ä¼ æ’­äº‹ä»¶
export interface SpreadEvent {
  from: string;
  to: string;
  time: TimePeriod;
  via?: string;
}

// èµ·æºä¿¡æ¯
export interface OriginInfo {
  location: string;
  time: TimePeriod;
}

// ä½œç‰©
export interface Crop {
  id: string;
  name: string;
  alias?: string[];
  category: CropCategory;
  origin: OriginInfo;
  spreads: SpreadEvent[];
  currentRegions: string[];
  description: string;
}

// é£Ÿç‰©
export interface Food {
  id: string;
  name: string;
  alias?: string[];
  category: FoodCategory;
  ingredients: string[];
  origin: OriginInfo;
  spreads: SpreadEvent[];
  currentRegions: string[];
  description: string;
}

// å®ä½“ç±»å‹ï¼ˆç”¨äºç»Ÿä¸€å¤„ç†ï¼‰
export type EntityType = 'crop' | 'food' | 'location';

// æœç´¢ç»“æœé¡¹
export interface SearchResultItem {
  id: string;
  name: string;
  type: EntityType;
  subtitle: string;
}

// èµ·æºåœ°æ•°æ®
export class OriginLocationData {
  crops: Crop[];
  foods: Food[];

  constructor(crops: Crop[], foods: Food[]) {
    this.crops = crops;
    this.foods = foods;
  }
}

// ç±»åˆ«åç§°è·å–å‡½æ•°
export function getCropCategoryName(category: CropCategory): string {
  switch (category) {
    case 'grain': return 'è°·ç‰©';
    case 'vegetable': return 'è”¬èœ';
    case 'fruit': return 'æ°´æœ';
    case 'legume': return 'è±†ç±»';
    case 'spice': return 'é¦™æ–™';
    case 'beverage': return 'é¥®æ–™ä½œç‰©';
    case 'oil': return 'æ²¹æ–™ä½œç‰©';
    case 'sugar': return 'ç³–æ–™ä½œç‰©';
    case 'nut': return 'åšæœ';
    case 'other': return 'å…¶ä»–ä½œç‰©';
    default: return '';
  }
}

export function getFoodCategoryName(category: FoodCategory): string {
  switch (category) {
    case 'staple': return 'ä¸»é£Ÿ';
    case 'dish': return 'èœè‚´';
    case 'beverage': return 'é¥®å“';
    case 'dessert': return 'ç”œç‚¹';
    case 'snack': return 'å°åƒ';
    case 'condiment': return 'è°ƒå‘³å“';
    case 'preserved': return 'è…Œåˆ¶é£Ÿå“';
    default: return '';
  }
}

// ============ æ—¶é—´çº¿ç›¸å…³ç±»å‹ ============

// æ—¶ä»£å®šä¹‰
export interface Era {
  id: string;
  name: string;
  icon: string;
  startYear: number;
  endYear: number;
  description: string;
}

// æ—¶é—´çº¿äº‹ä»¶ç±»å‹
export type TimelineEventType = 'origin' | 'spread';

// æ—¶é—´çº¿å®ä½“ç±»å‹
export type TimelineEntityType = 'crop' | 'food';

// æ—¶é—´çº¿äº‹ä»¶
export class TimelineEvent {
  id: string = '';
  entityId: string = '';
  entityType: TimelineEntityType = 'crop';
  eventType: TimelineEventType = 'origin';
  year: number = 0;
  displayTime: string = '';
  name: string = '';
  description: string = '';
  location?: string;
  locationId?: string;
  fromLocation?: string;
  fromLocationId?: string;
  toLocation?: string;
  toLocationId?: string;
  via?: string;

  constructor(init?: Partial<TimelineEvent>) {
    if (init) {
      Object.assign(this, init);
    }
  }
}

// æ—¶é—´çº¿ç­›é€‰æ¡ä»¶
export class TimelineFilter {
  entityType: 'all' | 'crop' | 'food' = 'all';
  eventType: 'all' | 'origin' | 'spread' = 'all';
  keyword: string = '';
}

// é¢„è®¾æ—¶ä»£åˆ—è¡¨
export const ERAS: Era[] = [
  {
    id: 'prehistoric',
    name: 'å²å‰æ—¶ä»£',
    icon: 'ğŸŒ¾',
    startYear: -10000,
    endYear: -5000,
    description: 'å†œä¸šé©å‘½çš„å¼€ç«¯ï¼Œäººç±»å¼€å§‹é©¯åŒ–ä½œç‰©'
  },
  {
    id: 'ancient',
    name: 'å¤ä»£æ–‡æ˜',
    icon: 'ğŸ›ï¸',
    startYear: -5000,
    endYear: -1000,
    description: 'å››å¤§æ–‡æ˜å¤å›½æ—¶æœŸï¼Œå†œä¸šæŠ€æœ¯ä¼ æ’­'
  },
  {
    id: 'classical',
    name: 'å¤å…¸æ—¶æœŸ',
    icon: 'âš”ï¸',
    startYear: -1000,
    endYear: 500,
    description: 'å¸Œè…Šç½—é©¬æ—¶ä»£ï¼Œä¸ç»¸ä¹‹è·¯å¼€é€š'
  },
  {
    id: 'medieval',
    name: 'ä¸­ä¸–çºª',
    icon: 'ğŸ°',
    startYear: 500,
    endYear: 1500,
    description: 'é˜¿æ‹‰ä¼¯å•†äººæ¨åŠ¨ä¸œè¥¿æ–¹äº¤æµ'
  },
  {
    id: 'exploration',
    name: 'å¤§èˆªæµ·æ—¶ä»£',
    icon: 'â›µ',
    startYear: 1500,
    endYear: 1800,
    description: 'å“¥ä¼¦å¸ƒå¤§äº¤æ¢ï¼Œæ–°æ—§å¤§é™†ä½œç‰©äº’é€š'
  },
  {
    id: 'modern',
    name: 'è¿‘ç°ä»£',
    icon: 'ğŸ­',
    startYear: 1800,
    endYear: 2100,
    description: 'å·¥ä¸šé©å‘½åçš„å…¨çƒåŒ–æ—¶ä»£'
  }
];

// è·å–äº‹ä»¶ç±»å‹åç§°
export function getEventTypeName(eventType: TimelineEventType): string {
  return eventType === 'origin' ? 'èµ·æº' : 'ä¼ æ’­';
}

// è·å–å®ä½“ç±»å‹åç§°
export function getTimelineEntityTypeName(entityType: TimelineEntityType): string {
  return entityType === 'crop' ? 'ä½œç‰©' : 'é£Ÿç‰©';
}

// è·å–äº‹ä»¶é¢œè‰²
export function getEventColor(entityType: TimelineEntityType, eventType: TimelineEventType): string {
  if (entityType === 'crop') {
    return eventType === 'origin' ? '#4CAF50' : '#2196F3';
  } else {
    return eventType === 'origin' ? '#FF9800' : '#9C27B0';
  }
}
